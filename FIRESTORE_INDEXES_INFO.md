# Firestore ç´¢å¼•éƒ¨ç½²èªªæ˜

## âœ… å·²å®Œæˆçš„æ“ä½œ

1. å‰µå»ºäº† `firestore.indexes.json` é…ç½®æª”
2. æ›´æ–°äº† `firebase.json` ä»¥åŒ…å« Firestore é…ç½®
3. æˆåŠŸéƒ¨ç½²ç´¢å¼•åˆ° Firebase

## ğŸ“‹ å·²éƒ¨ç½²çš„ç´¢å¼•

### 1. pointsRecords é›†åˆ
- **æ¬„ä½**: `userId` (å‡åº) + `createdAt` (é™åº)
- **ç”¨é€”**: è®“ç”¨æˆ¶å¯ä»¥æŸ¥è©¢è‡ªå·±çš„ç©åˆ†è¨˜éŒ„ä¸¦æŒ‰æ™‚é–“æ’åº

### 2. matches é›†åˆ
- **æ¬„ä½**: `status` (å‡åº) + `expireAt` (å‡åº)
- **ç”¨é€”**: æª¢æŸ¥éæœŸçš„é…å°è¨˜éŒ„

## â³ æ¥ä¸‹ä¾†æœƒç™¼ç”Ÿä»€éº¼

Firebase æ­£åœ¨å¾Œå°å»ºç«‹é€™äº›ç´¢å¼•ã€‚ä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹å»ºç«‹é€²åº¦**ï¼š
   - å‰å¾€ [Firebase Console - Firestore Indexes](https://console.firebase.google.com/project/surveyhelp-891d4/firestore/indexes)
   - ä½ æœƒçœ‹åˆ°ç´¢å¼•ç‹€æ…‹ï¼š
     - ğŸŸ¡ "Building" = å»ºç«‹ä¸­
     - ğŸŸ¢ "Enabled" = å·²å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨

2. **å»ºç«‹æ™‚é–“**ï¼š
   - å°å‹è³‡æ–™åº«ï¼ˆ<1000ç­†ï¼‰ï¼šå¹¾åˆ†é˜
   - ä¸­å‹è³‡æ–™åº«ï¼ˆ1000-10000ç­†ï¼‰ï¼š10-30åˆ†é˜
   - å¤§å‹è³‡æ–™åº«ï¼ˆ>10000ç­†ï¼‰ï¼šå¯èƒ½éœ€è¦å¹¾å°æ™‚

3. **åœ¨ç´¢å¼•å»ºç«‹æœŸé–“**ï¼š
   - æ‡‰ç”¨ç¨‹å¼ä»ç„¶å¯ä»¥é‹è¡Œ
   - ä½†ç›¸é—œæŸ¥è©¢æœƒé¡¯ç¤ºéŒ¯èª¤ï¼ˆå°±åƒä½ ä¹‹å‰çœ‹åˆ°çš„ï¼‰
   - ç´¢å¼•å®Œæˆå¾Œï¼ŒéŒ¯èª¤æœƒè‡ªå‹•æ¶ˆå¤±

## ğŸ” å¦‚ä½•ç¢ºèªç´¢å¼•å·²å®Œæˆ

### æ–¹æ³• 1ï¼šæŸ¥çœ‹ Firebase Console
è¨ªå•ï¼šhttps://console.firebase.google.com/project/surveyhelp-891d4/firestore/indexes

### æ–¹æ³• 2ï¼šé‡æ–°è¼‰å…¥æ‡‰ç”¨ç¨‹å¼
ç´¢å¼•å®Œæˆå¾Œï¼š
- ç©åˆ†è¨˜éŒ„é é¢æœƒæ­£å¸¸é¡¯ç¤º
- ä¸å†æœ‰ "The query requires an index" éŒ¯èª¤
- éæœŸæª¢æŸ¥åŠŸèƒ½æœƒæ­£å¸¸é‹ä½œ

## ğŸ“ ç›¸é—œæª”æ¡ˆ

- `firestore.indexes.json` - ç´¢å¼•é…ç½®æª”
- `firestore.rules` - Firestore å®‰å…¨è¦å‰‡
- `firebase.json` - Firebase é …ç›®é…ç½®

## ğŸ”§ æœªä¾†ç¶­è­·

å¦‚æœä½ éœ€è¦æ·»åŠ æ–°çš„ç´¢å¼•ï¼š

1. ç·¨è¼¯ `firestore.indexes.json`
2. åŸ·è¡Œéƒ¨ç½²æŒ‡ä»¤ï¼š
   ```bash
   firebase deploy --only firestore:indexes
   ```

æˆ–è€…ç›´æ¥é»æ“ŠéŒ¯èª¤è¨Šæ¯ä¸­çš„é€£çµï¼Œåœ¨ Firebase Console æ‰‹å‹•å»ºç«‹ã€‚

## ğŸ’¡ æç¤º

- ç´¢å¼•é…ç½®å·²åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ˜éšŠæˆå“¡å¯ä»¥åŒæ­¥é€™äº›è¨­å®š
- å®šæœŸæª¢æŸ¥ Firebase Console çš„ç´¢å¼•ä½¿ç”¨æƒ…æ³
- åˆªé™¤ä¸å†ä½¿ç”¨çš„ç´¢å¼•å¯ä»¥ç¯€çœè³‡æº

